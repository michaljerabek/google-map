!function(t){window.GoogleMaps=function(){var i=[],e=!1,o=t.Deferred(),s=function(t){return t instanceof GoogleMap&&(i.push(t),e&&t.init(),t)},n=function(){i.forEach(function(t){t.init()}),e=!0};return window.googleMapsInit=function(){o.resolve(i),o.then(n)},{addMap:s,promise:function(){return o.promise()}}}()}(jQuery),function(t){var i={el:"#map",zoom:14,controls:!1,styles:[],coords:"center",centerToLocationOnResize:0,fitBoundsOnResize:0},e=window.GoogleMap=function(e){if("object"!=typeof e)throw"Options required!";this.options=t.extend({},i,e),this.options.styles.googleMap=this,this.el=null,this.$el=null,this.map=null,this._animations={},this._$animEl=t("<div></div>"),this._idHTMLCounter=0,this._idMarkerCounter=0,this._idInfoCounter=0,this._markers=[],this._markersDefers={},this._infos=[],this._infosDefers={},this._htmls=[],this._htmlsDefers={},this.markers={},this.groupedMarkers={},this.infos={},this.HTMLs={},this.markerId=null,this.infoId=null,this.HTMLId=null,this._defer=t.Deferred(),GoogleMaps.addMap(this)},o=function(t){switch(t){case"HTML":return this.HTMLs[++this._idHTMLCounter]?o.call(this,t):this._idHTMLCounter;case"Marker":return this.markers[++this._idMarkerCounter]?o.call(this,t):this._idMarkerCounter;case"Info":return this.infos[++this._idInfoCounter]?o.call(this,t):this._idInfoCounter}},s=function(){t.each(this.infos,function(t,i){i.close()})},n=function(t,i){var e=!1,o=this;google.maps.event.addListener(i,"touchend",function(){e=!0,s.call(o),t.open(this.map,this)}),google.maps.event.addListener(i,"click",function(){return e?void(e=!1):(s.call(o),void t.open(this.map,this))})},r=function(t){return t instanceof google.maps.LatLng?t:t instanceof Array?new google.maps.LatLng(t[0],t[1]):null},a=function(){var t=r(this.options.coords);return!t&&this.options.markers&&this.options.markers[0]&&this.options.markers[0].coords&&(t=r(this.options.markers[0].coords)),!t&&this._markers&&this._markers[0]&&this._markers[0].coords&&(t=r(this._markers[0].coords)),!t&&this.options.html&&this.options.html[0]&&this.options.html[0].coords&&(t=r(this.options.html[0].coords)),!t&&this._html&&this._html[0]&&this._html[0].coords&&(t=r(this._html[0].coords)),t};e.DEFAULTS=i,e.STYLES={},e.STYLES.empty=function(){return[]},e.prototype.init=function(){if(!(this.options.coords&&"string"!=typeof this.options.coords||this.options.markers||this.options.html||this._markers.length||this._html.length))return void console.error("GoogleMap could not be initialized! Set coords option or add Marker or HTML!");this.bounds=new google.maps.LatLngBounds,this.$el=this.options.el.jquery?this.options.el:t(this.options.el),this.el=this.$el[0];var i={zoom:this.options.zoom,location:a.call(this),styles:this.options.styles||(window.GoogleMapStyle?new GoogleMapStyle:e.STYLES.empty())};i.center=i.location,this.options.controls||e.DEFAULTS.controls||(i.zoomControl=!1,i.mapTypeControl=!1,i.scaleControl=!1,i.streetViewControl=!1,i.rotateControl=!1,i.fullscreenControl=!1),this.options.options&&(i=t.extend({},i,this.options.options)),this.map=new google.maps.Map(this.el,i),this.options.centerToLocationOnResize&&this.initCenterToLocationOnResize(this.options.centerToLocationOnResize),this.options.fitBoundsOnResize&&this.initFitBoundsOnResize(this.options.fitBoundsOnResize),this.options.centerToBoundsCenterOnResize&&this.initCenterToBoundsCenterOnResize(this.options.centerToBoundsCenterOnResize),this.initialized=!0,(this.options.icon||this.options.addMarker)&&(this.markerId=o.call(this,"Marker"),this.options.info&&(this.infoId=o.call(this,"Info")),this.addMarker({coords:i.location,icon:this.options.icon,info:this.options.info,infoId:this.options.infoId,id:this.markerId})),this.options.markers&&this.options.markers.forEach(this.addMarker.bind(this)),this.options.html&&(this.options.html instanceof Array?this.options.html.forEach(this.addHTML.bind(this)):(this.HTMLId=o.call(this,"HTML"),this.addHTML({html:this.options.html,id:this.HTMLId}))),this._markers.forEach(this.addMarker.bind(this)),this._infos.forEach(this.addInfo.bind(this)),this._htmls.forEach(this.addHTML.bind(this)),"bounds"===this.options.coords?this.fitBounds():"center"===this.options.coords&&this.map.setOptions({location:this.bounds.getCenter(),center:this.bounds.getCenter()}),"function"==typeof this.options.onInit&&this.options.onInit.call(this),this._defer.resolve(this,this.markers[this.markerId],this.markerId)},e.prototype.promise=function(){return this._defer.promise()},e.prototype.addMarker=function(i){i=i||{};var e=i.id||o.call(this,"Marker"),s=this._markersDefers[i.id]||t.Deferred();if(!this.initialized)return i.id=i.id||e,this._markers.push(i),this._markersDefers[i.id]=s,s.promise();!i.coords||i.coords instanceof google.maps.LatLng||(i.coords=new google.maps.LatLng(i.coords[0],i.coords[1]));var n={position:i.coords||this.map.location,map:this.map,icon:i.icon||this.options.icon};i.options&&(n=t.extend({},n,i.options));var r=new google.maps.Marker(n);return i.info&&this.addInfo({content:i.info,marker:r,id:i.infoId}),this.markers[e]=r,i.group=i.group||"no-group",this.groupedMarkers[i.group]=this.groupedMarkers[i.group]||{},this.groupedMarkers[i.group][e]=r,this.bounds.extend(r.position),s.resolve(this,r,e),s.promise()},e.prototype.getMarker=function(t){return this.markers[t]||null},e.prototype.addInfo=function(i){i=i||{};var e=i.id||o.call(this,"Info"),s=this._infosDefers[i.id]||t.Deferred();if(!this.initialized)return i.id=i.id||e,this._infos.push(i),this._infosDefers[i.id]=s,s.promise();i.marker=i.marker||this.markers[this.markers.length-1];var r={content:i.content};i.options&&(r=t.extend({},r,i.options));var a=new google.maps.InfoWindow(r);return n.call(this,a,i.marker),this.infos[e]=a,s.resolve(this,a,e),s.promise()},e.prototype.getInfo=function(t){return this.infos[t]||null},e.prototype.addHTML=function(i){i=i||{};var e=i.id||o.call(this,"HTML"),s=this._htmlsDefers[i.id]||t.Deferred();if(!this.initialized)return"string"==typeof i?i={html:i,id:e}:i.id=i.id||e,this._htmls.push(i),this._htmlsDefers[i.id]=s,s.promise();var n,r="string"==typeof i||i instanceof HTMLElement?i:i.html,a="object"!=typeof i||i instanceof HTMLElement?null:i.coords,h="object"!=typeof i||i instanceof HTMLElement?null:i.draw,p=function(){s.resolve(this,n,e)}.bind(this);return n=new GoogleMapHTMLOverlay(this.map,r,a,h,p),this.HTMLs[e]=n,this.bounds.extend(n.position),s.promise()},e.prototype.getHTML=function(t){return this.HTMLs[t]||null},e.prototype.initCenterToBoundsCenterOnResize=function(t){if(!this.resizeCenterToBoundsCenterInitialized){var i="number"==typeof t,e=this;google.maps.event.addDomListener(window,"resize",function(){return i?(clearTimeout(i),void(i=setTimeout(e.center.bind(e),t))):void e.center()}),this.resizeCenterToBoundsCenterInitialized=!0}},e.prototype.initCenterToLocationOnResize=function(t){if(!this.resizeCenterToLocationInitialized){var i="number"==typeof t,e=this;google.maps.event.addDomListener(window,"resize",function(){return i?(clearTimeout(i),void(i=setTimeout(e.centerToLocation.bind(e),t))):void e.centerToLocation()}),this.resizeCenterToLocationInitialized=!0}},e.prototype.initFitBoundsOnResize=function(t){if(!this.resizeFitBoundsInitialized){var i="number"==typeof t,e=this;google.maps.event.addDomListener(window,"resize",function(){return i?(clearTimeout(i),void(i=setTimeout(e.fitBounds.bind(e),t))):void e.fitBounds()}),this.resizeFitBoundsInitialized=!0}},e.prototype.centerToLocation=function(){this.map.setCenter(this.map.location)},e.prototype.fitBounds=function(){this.map.fitBounds(this.bounds)},e.prototype.center=function(t){"string"!=typeof t&&"number"!=typeof t||(t=this.getMarker(t)||this.getHTML(t)),t instanceof Array&&(t=new google.maps.LatLng(t[0],t[1])),t instanceof google.maps.LatLng?this.map.setCenter(t):t&&t.position?this.map.setCenter(t.position):this.map.setCenter(this.bounds.getCenter())},e.prototype.animate=function(t,i,e){if("string"!=typeof t&&"number"!=typeof t||(t=this.getMarker(t)),t){var o=t.getPosition().toString();clearTimeout(this._animations[o]),null!==t.getAnimation()&&t.setAnimation(null),t.setAnimation(e||google.maps.Animation.BOUNCE),this._animations[o]=setTimeout(t.setAnimation.bind(t,null),i||2800)}},e.prototype.animateGroup=function(i,e,o){t.each(this.groupedMarkers[i],function(t,i){this.animate(i,e,o)}.bind(this))},e.prototype.opacity=function(t,i,e,o){if("string"!=typeof t&&"number"!=typeof t||(t=this.getMarker(t)),t&&e){var s;return void this._$animEl.stop(!0,!0).animate({opacity:i},{duration:e,progress:function(e,o){"number"!=typeof s&&(s="number"==typeof t.getOpacity()?t.getOpacity():t.getVisible()?1:0);var n=s-i;n&&t.setOpacity(s-n*o),!t.getVisible()&&i>0&&t.setVisible(!0),0===i&&1===o&&t.setVisible(!1)},easing:o||"linear"})}t.setOpacity(i),t.setVisible(i>0)},e.prototype.groupOpacity=function(i,e,o,s){if(o){var n=[];return void this._$animEl.stop(!0,!0).animate({opacity:e},{duration:o,progress:function(o,s){t.each(this.groupedMarkers[i],function(t,i){"number"!=typeof n[t]&&(n[t]="number"==typeof i.getOpacity()?i.getOpacity():i.getVisible()?1:0);var o=n[t]-e;o&&i.setOpacity(n[t]-o*s),!i.getVisible()&&e>0&&i.setVisible(!0),0===e&&1===s&&i.setVisible(!1)}.bind(this))}.bind(this),easing:s||"linear"})}t.each(this.groupedMarkers[i],function(t,i){i.setOpacity(e),i.setVisible(e>0)}.bind(this))},e.prototype.show=function(t,i,e){this.opacity(t,1,i,e)},e.prototype.showGroup=function(t,i,e){this.groupOpacity(t,1,i,e)},e.prototype.hide=function(t,i,e){this.opacity(t,0,i,e)},e.prototype.hideGroup=function(t,i,e){this.groupOpacity(t,0,i,e)},e.prototype.highlight=function(i,e,o,s){if(o=o||0,"string"!=typeof i&&"number"!=typeof i||(i=this.getMarker(i)),e){var n=[];return void this._$animEl.stop(!0).animate({opacity:o},{duration:e,progress:function(e,s){t.each(this.markers,function(t,e){"number"!=typeof n[t]&&(n[t]="number"==typeof e.getOpacity()?e.getOpacity():e.getVisible()?1:0);var r=e!==i&&i!==!1?o:1,a=n[t]-r;a&&e.setOpacity(n[t]-a*s),0===r&&1===s&&e.setVisible(!1),r>0&&!e.getVisible()&&e.setVisible(!0)})}.bind(this),easing:s||"linear"})}t.each(this.markers,function(t,e){o?(e.setOpacity(e===i||i===!1?1:o),(e===i||i===!1||o>0)&&e.setVisible(!0),e!==i&&i===!1&&0===o&&e.setVisible(!1)):(e!==i&&i!==!1||e.setOpacity(1),e.setVisible(e===i||i===!1))})},e.prototype.highlightGroup=function(i,e,o,s){if(o=o||0,e){var n={};return void this._$animEl.stop(!0).animate({opacity:o},{duration:e,progress:function(e,s){t.each(this.groupedMarkers,function(e){"object"!=typeof n[e]&&(n[e]=[]),t.each(this.groupedMarkers[e],function(t,r){"number"!=typeof n[e][t]&&(n[e][t]="number"==typeof r.getOpacity()?r.getOpacity():r.getVisible()?1:0);var a=e!==i&&i!==!1?o:1,h=n[e][t]-a;h&&r.setOpacity(n[e][t]-h*s),0===a&&1===s&&r.setVisible(!1),a>0&&!r.getVisible()&&r.setVisible(!0)}.bind(this))}.bind(this))}.bind(this),easing:s||"linear"})}t.each(this.groupedMarkers,function(e){t.each(this.groupedMarkers[e],function(t,s){o?(s.setOpacity(e===i||i===!1?1:o),(e===i||i===!1||o>0)&&s.setVisible(!0),e!==i&&i===!1&&0===o&&s.setVisible(!1)):(e!==i&&i!==!1||s.setOpacity(1),s.setVisible(e===i||i===!1))}.bind(this))}.bind(this))},e.prototype.on=function(t,i){return this.map.addListener(t,i)},e.prototype.off=function(t){this.map.removeListener(t)},e.prototype.onMarker=function(t,i,e){return"string"!=typeof t&&"number"!=typeof t||(t=this.getMarker(t)),google.maps.event.addListener(t,i,e)},e.prototype.offMarker=function(t){google.maps.event.removeListener(t)}}(jQuery),function(t){var i=window.GoogleMapHTMLOverlay=function(t,i,e,o,s){this.html=i,this.$el=null,this.el=null,this.map=t,this._resolve=s,o&&(this.draw=o),e instanceof google.maps.LatLng?this.position=e:e instanceof google.maps.Marker?this.position=e.position:e instanceof Array?this.position=new google.maps.LatLng(e[0],e[1]):this.position=this.map.location,this.setMap(t)};GoogleMaps.promise().then(function(){i.prototype=new google.maps.OverlayView,i.prototype.onAdd=function(){var i=this.getPanes();this.$el=t("<div></div>"),this.$el.css("position","absolute").html(this.html).appendTo(i.overlayMouseTarget),this.el=this.$el[0],this._resolve()},i.prototype.draw=function(){var t=this.getProjection();this.pxPosition=t.fromLatLngToDivPixel(this.position),this.size={width:this.el.offsetWidth||(this.size?this.size.width:0),height:this.el.offsetHeight||(this.size?this.size.height:0)},this.size.width&&this.size.height&&(this.el.style.left=this.pxPosition.x-this.size.width/2+"px",this.el.style.top=this.pxPosition.y-this.size.height+"px")},i.prototype.onRemove=function(){this.$el.remove(),this.$el=null,this.el=null},i.prototype.show=function(t){var i=Array.prototype.slice.call(arguments);return t===!1&&(i[0]=0),this.$el.fadeIn.apply(this.$el,i)},i.prototype.hide=function(t){var i=Array.prototype.slice.call(arguments);return t===!1&&(i[0]=0),this.$el.fadeOut.apply(this.$el,i)},i.prototype.animate=function(){return this.$el.animate.apply(this.$el,arguments)},i.prototype.css=function(){return this.$el.css.apply(this.$el,arguments)},i.prototype.find=function(){return this.$el.find.apply(this.$el,arguments)},i.prototype.addClass=function(){return this.$el.addClass.apply(this.$el,arguments)},i.prototype.removeClass=function(){return this.$el.removeClass.apply(this.$el,arguments)},i.prototype.hasClass=function(){return this.$el.hasClass.apply(this.$el,arguments)}})}(jQuery);
